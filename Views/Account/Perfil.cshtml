@using INTELISIS.APPCORE.EL
@model UsuarioPortal
@{
    ViewData["Title"] = "Mi Perfil";
}
<div class="pagetitle">
    <h1>Perfil</h1>
</div>

<section class="section profile">
    <div class="row">
        <div class="col-xl-4">

            <div class="card">
                <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">

                    <img src="@Url.Content(Model.ImagenDePerfil)" alt="Profile" class="rounded-circle">
                    <h2>@Model.NombreCompleto</h2>
                    <h3>@Model.Rol</h3>
                </div>
            </div>

        </div>

        <div class="col-xl-8">

            <div class="card">
                <div class="card-body pt-3">
                    <!-- Bordered Tabs -->
                    <ul class="nav nav-tabs nav-tabs-bordered">

                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-overview">Vista general</button>
                        </li>

                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-edit">Editar Perfil</button>
                        </li>

                    </ul>
                    <div class="tab-content pt-2">
                        <div class="tab-pane fade show active profile-overview" id="profile-overview">
                            <h5 class="card-title">@Html.DisplayNameFor(m=>m.Descripcion)</h5>
                            <p class="small fst-italic">@Model.Descripcion</p>

                            <h5 class="card-title">Detalles del perfil</h5>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label ">@Html.DisplayNameFor(m=>m.NombreCompleto)</div>
                                <div class="col-lg-9 col-md-8">@Model.NombreCompleto</div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">@Html.DisplayNameFor(m => m.Empresa)</div>
                                <div class="col-lg-9 col-md-8">@Model.Empresa</div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">@Html.DisplayNameFor(m => m.Rol)</div>
                                <div class="col-lg-9 col-md-8">@Model.Rol</div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">@Html.DisplayNameFor(m => m.Direccion)</div>
                                <div class="col-lg-9 col-md-8">@Model.Direccion</div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">@Html.DisplayNameFor(m => m.Telefono)</div>
                                <div class="col-lg-9 col-md-8">@Model.Telefono</div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">@Html.DisplayNameFor(m => m.Email)</div>
                                <div class="col-lg-9 col-md-8">@Model.Email</div>
                            </div>

                        </div>

                        <div class="tab-pane fade profile-edit pt-3" id="profile-edit">

                            <form asp-action="GuardarDatosUser" method="post" enctype="multipart/form-data">
                                <div class="row mb-3">
                                    <label for="profileImage" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.ImagenDePerfil)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <!-- Mostrar la imagen actual -->
                                        <img src="@Url.Content(Model.ImagenDePerfil)" alt="Profile" class="img-thumbnail" id="profileImagePreview" style="max-width: 150px; max-height: 150px;">
                                        <div class="pt-2">
                                            <!-- Input para seleccionar la imagen (oculto) -->
                                            <input type="file" id="uploadImage" name="uploadImage" style="display: none;" accept="image/*">

                                            <!-- Botón para abrir el selector de archivos -->
                                            <button type="button" class="btn btn-primary btn-sm" title="Subir nueva imagen" onclick="document.getElementById('uploadImage').click()">
                                                <i class="bi bi-upload"></i>
                                            </button>

                                            <!-- Botón para eliminar la imagen seleccionada -->
                                            <button type="button" class="btn btn-danger btn-sm" title="Eliminar imagen" onclick="removeImage()">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="fullName" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.NombreCompleto)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <input asp-for="NombreCompleto" type="text" class="form-control" id="fullName" value="@Model.NombreCompleto" readonly>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="about" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.Descripcion)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <textarea asp-for="Descripcion" class="form-control" id="about" style="height: 100px">@Model.Descripcion</textarea>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="company" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.Empresa)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <input asp-for="Empresa" type="text" class="form-control" id="company" value="@Model.Empresa" readonly>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="Job" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.Rol)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <input type="text" asp-for="Rol" class="form-control" id="Job" value="@Model.Rol" readonly>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="Address" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.Direccion)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <input type="text" asp-for="Direccion" class="form-control" id="Address" value="@Model.Direccion">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="Phone" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.Telefono)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <input type="text" asp-for="Telefono" class="form-control" id="Phone" value="@Model.Telefono">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="Email" class="col-md-4 col-lg-3 col-form-label">@Html.DisplayNameFor(m => m.Email)</label>
                                    <div class="col-md-8 col-lg-9">
                                        <input name="email" type="email" asp-for="Email" class="form-control" id="Email" value="@Model.Email" readonly>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                                </div>
                            </form><!-- End Profile Edit Form -->

                        </div>

                    </div><!-- End Bordered Tabs -->

                </div>
            </div>

        </div>
    </div>
</section>
@section Scripts{
    <script>
        // Obtener el input de tipo file y el contenedor de la imagen
        const uploadImage = document.getElementById('uploadImage');
        const profileImagePreview = document.getElementById('profileImagePreview');

        // Escuchar cambios en el input de tipo file
        uploadImage.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    // Mostrar la imagen seleccionada en el contenedor
                    profileImagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Función para eliminar la imagen seleccionada
        function removeImage() {
            // Restablecer la imagen a una por defecto
            const defaultImage = '/img/profile-img.png'; // Ruta absoluta o relativa válida
            document.getElementById('profileImagePreview').src = defaultImage;

            // Limpiar el input de tipo file
            document.getElementById('uploadImage').value = '';

            // Opcional: Enviar una señal al servidor para eliminar la imagen del perfil
            // Esto depende de cómo manejes la eliminación en el backend
            // Por ejemplo, podrías hacer una llamada AJAX para notificar al servidor.
        }
    </script>
}